
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.mybatisStore.cart.repository.CartMapper">

    <!-- Cart 아이디로 조회하는 SQL -->
    <select id="getCartById" resultType="com.example.mybatisStore.cart.entity.Cart">
        SELECT
            cartId,
            id as id
        FROM
            carts
        WHERE
            cartId = #{cartId}
    </select>

    <!-- Cart와 User 정보를 함께 조회하는 SQL -->
    <select id="getCartWithUserById" resultMap="cartWithUser">
        SELECT
            c.cartId,
            c.id as id,
            u.username,
            u.email,
            u.password,
            u.phone,
            u.age,
            u.address,
            u.role
        FROM
            carts c
                LEFT JOIN users u ON c.id = u.id
        WHERE
            c.cartId = #{cartId}
    </select>


    <resultMap id="cartWithUser" type="com.example.mybatisStore.cart.entity.Cart">
        <id property="cartId" column="cartId"/>
        <association property="user" column="id" javaType="com.example.mybatisStore.user.entity.User" select="com.example.mybatisStore.user.repository.UserMapper.getUserById"/>
    </resultMap>

    <insert id="insertCart" parameterType="com.example.mybatisStore.cart.entity.Cart">
        INSERT INTO carts (id) VALUES (#{user.id})
    </insert>

</mapper>
